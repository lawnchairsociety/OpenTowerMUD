<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Tower MUD - Web Client</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #header {
            background: #16213e;
            padding: 10px 20px;
            border-bottom: 2px solid #0f3460;
        }
        #header h1 {
            margin: 0;
            color: #e94560;
            font-size: 1.5em;
        }
        #connection-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-left: 15px;
        }
        .connected {
            background: #2ecc71;
            color: #1a1a2e;
        }
        .disconnected {
            background: #e74c3c;
            color: white;
        }
        #terminal {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #0d1117;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
        }
        #input-container {
            display: flex;
            padding: 10px;
            background: #16213e;
            border-top: 2px solid #0f3460;
        }
        #command-input {
            flex: 1;
            padding: 10px 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: #1a1a2e;
            border: 2px solid #0f3460;
            border-radius: 5px;
            color: #e0e0e0;
            outline: none;
        }
        #command-input:focus {
            border-color: #e94560;
        }
        #send-btn {
            margin-left: 10px;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: #e94560;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        #send-btn:hover {
            background: #c73e54;
        }
        #send-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .server-message {
            color: #e0e0e0;
        }
        .user-message {
            color: #3498db;
        }
        .system-message {
            color: #f39c12;
            font-style: italic;
        }
        .error-message {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>Open Tower MUD
            <span id="connection-status" class="disconnected">Disconnected</span>
        </h1>
    </div>

    <div id="terminal"></div>

    <div id="input-container">
        <input type="text" id="command-input" placeholder="Enter command..." autocomplete="off" disabled>
        <button id="send-btn" disabled>Send</button>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        const sendBtn = document.getElementById('send-btn');
        const connectionStatus = document.getElementById('connection-status');

        let ws = null;
        let commandHistory = [];
        let historyIndex = -1;

        function appendMessage(text, className) {
            const span = document.createElement('span');
            span.className = className;
            span.textContent = text;
            terminal.appendChild(span);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function connect() {
            const wsUrl = `ws://${window.location.hostname}:4443/ws`;
            appendMessage(`Connecting to ${wsUrl}...\n`, 'system-message');

            ws = new WebSocket(wsUrl);

            ws.onopen = function() {
                appendMessage('Connected!\n', 'system-message');
                connectionStatus.textContent = 'Connected';
                connectionStatus.className = 'connected';
                commandInput.disabled = false;
                sendBtn.disabled = false;
                commandInput.focus();
            };

            ws.onmessage = function(event) {
                appendMessage(event.data, 'server-message');
            };

            ws.onclose = function() {
                appendMessage('\nConnection closed.\n', 'system-message');
                connectionStatus.textContent = 'Disconnected';
                connectionStatus.className = 'disconnected';
                commandInput.disabled = true;
                sendBtn.disabled = true;

                // Auto-reconnect after 3 seconds
                setTimeout(connect, 3000);
            };

            ws.onerror = function(error) {
                appendMessage('\nConnection error!\n', 'error-message');
            };
        }

        function sendCommand() {
            const command = commandInput.value.trim();
            if (command && ws && ws.readyState === WebSocket.OPEN) {
                // Add to history
                commandHistory.push(command);
                historyIndex = commandHistory.length;

                // Show what user typed
                appendMessage(`> ${command}\n`, 'user-message');

                // Send to server
                ws.send(command);

                // Clear input
                commandInput.value = '';
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendCommand);

        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                sendCommand();
            } else if (e.key === 'ArrowUp') {
                // Navigate command history up
                if (historyIndex > 0) {
                    historyIndex--;
                    commandInput.value = commandHistory[historyIndex];
                }
                e.preventDefault();
            } else if (e.key === 'ArrowDown') {
                // Navigate command history down
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    commandInput.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    commandInput.value = '';
                }
                e.preventDefault();
            }
        });

        // Start connection
        connect();
    </script>
</body>
</html>
